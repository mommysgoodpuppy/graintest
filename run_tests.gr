module RunTests

from "wasi/process" include Process
from "list" include List
from "array" include Array
from "string" include String
from "option" include Option
from "result" include Result

from "./lib/test.gr" include Test
from "./lib/bdd.gr" include Bdd

let printUsage = () => {
  print("Grain Test Framework")
  print("====================")
  print("")
  print("USAGE:")
  print("  grain --dir . run_tests.gr -- [OPTIONS]")
  print("")
  print("OPTIONS:")
  print("  --help, -h       Show this help message")
  print("  --filter, -f     Filter tests by name")
  print("")
  print("RUNNING INDIVIDUAL TEST FILES:")
  print("  grain tests/math_test.gr")
  print("  grain tests/string_test.gr")
  print("  grain tests/bdd_test.gr")
  print("  grain tests/hooks_test.gr")
  print("")
  print("WRITING TESTS:")
  print("  See README.md for documentation")
}

let main = () => {
  match (Process.argv()) {
    Ok(args) => {
      let argsList = Array.toList(args)
      let hasHelp = List.some(arg => arg == "--help" || arg == "-h", argsList)
      
      if (hasHelp || List.length(argsList) <= 1) {
        printUsage()
      } else {
        print("To run tests, execute individual test files:")
        print("")
        print("  grain tests/math_test.gr")
        print("  grain tests/string_test.gr")
        print("  grain tests/bdd_test.gr")
        print("")
        print("Or run with --help for more options.")
      }
    },
    Err(_) => {
      printUsage()
    },
  }
}

main()
